2026-01-18: Bumped VERSION from 3.1.0 to 3.2.0 on line 15 of ralphy.sh. Added BATS test suite in tests/version.bats to verify version variable and --version flag output. Tests pass. Linting passes.
2026-01-18: Added 10-minute timeout (AI_TIMEOUT=600) to AI commands. Added get_timeout_cmd() helper for cross-platform support (timeout on Linux, gtimeout on macOS). Wrapped all AI engine commands in run_ai_command() and run_parallel_agent() with timeout. Added --timeout N flag to override default. Added BATS tests in tests/timeout.bats. Tests pass. Linting passes (no errors).
2026-01-18: Fixed ShellCheck SC2086 on line 708 (formerly 702). Changed unquoted `$draft_flag` to safe parameter expansion `${draft_flag:+"$draft_flag"}` in gh pr create command. Added BATS tests in tests/shellcheck-fixes.bats to verify the fix. Tests pass. Linting passes (SC2086 resolved, other warnings are pre-existing).
2026-01-18: Marked --timeout N flag task as complete in PRD.md. Implementation was already done (line 244-247 parse_args, tests in tests/timeout.bats). Tests pass. Linting passes.
2026-01-18: Implemented agent-specific progress files for parallel mode. Changed run_parallel_agent() to create progress-agent-$agent_num.txt instead of shared progress.txt. Added merge_agent_progress_files() function to merge all agent files after parallel execution completes. Added BATS tests in tests/parallel-progress.bats (8 tests). Tests pass (17 total). Linting passes (no new errors).
2026-01-18: Added checkpoint file (.ralphy-checkpoint) that saves iteration count after each task completion. Added CHECKPOINT_FILE variable, save_checkpoint(), read_checkpoint(), and clear_checkpoint() functions. Checkpoint is saved after each successful task in run_single_task() and cleared when all tasks complete in both sequential and parallel modes. Added BATS tests in tests/checkpoint.bats (11 tests). Tests pass (28 total). Linting passes (no errors, pre-existing warnings unchanged).
2026-01-18: Implemented --resume flag that reads .ralphy-checkpoint and skips already-completed iterations. Added RESUME variable (default false), --resume flag parsing in parse_args(), help documentation, and mode display. Resume logic in main() reads checkpoint via read_checkpoint() and sets iteration counter to skip completed work. Added BATS tests in tests/resume.bats (10 tests). Tests pass (38 total). Linting passes (no new errors).
2026-01-18: Added Qwen-Code output format validation and fallback parsing. Enhanced qwen case in parse_ai_result() (lines 1110-1155) with: (1) is_error field validation for Qwen-specific error handling, (2) Fallback 1: assistant message content array parsing, (3) Fallback 2: text field extraction via regex, (4) Fallback 3: plain text (non-JSON) detection. Added BATS tests in tests/qwen-parsing.bats (12 tests). Tests pass (50 total). Linting passes (no new ShellCheck errors).
2026-01-18: Added warning when --resume and --parallel are used together. Implemented check in main() (line 2288-2290) that logs warning via log_warn() when both flags are set, since resume functionality is only implemented in sequential mode and is ignored in parallel mode. Added 3 BATS tests in tests/resume.bats (now 13 tests). Tests pass (53 total). Linting passes (no new ShellCheck errors).
2026-01-18: Added --model MODEL flag to pass model selection to underlying AI CLI. Added AI_MODEL variable (default empty), --model flag parsing in parse_args(), help documentation, and mode display. Updated run_ai_command() and run_parallel_agent() to construct model_flag and pass it to all 5 AI engines (Claude, OpenCode, Cursor, Codex, Qwen) using ${model_flag:+$model_flag} parameter expansion. Added AI_MODEL to export list for parallel mode. Added BATS tests in tests/model.bats (12 tests). Tests pass (65 total). Linting passes (no new ShellCheck errors).
2026-01-18: Fixed parallel mode progress file race condition. Agent progress files (progress-agent-N.txt) were created in worktree directories but the worktrees were deleted before merge_agent_progress_files() ran. Added copy of progress files from worktree to ORIGINAL_DIR before cleanup_agent_worktree() in three code paths: (1) success path (line 1740-1743), (2) no-commit failure path (line 1718-1721), and (3) general failure path (line 1756-1759). Added 4 BATS tests in tests/parallel-progress.bats (now 12 tests). Tests pass (69 total). Linting passes (no new ShellCheck errors).
